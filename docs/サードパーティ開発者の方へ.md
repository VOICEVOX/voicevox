# サードパーティ開発者の方へ

## サードパーティが利用するときの注意

### VOICEVOXへのアクセスについて

VOICEVOXには連携のためにAPIがあります。特別な理由がない限り、API以外でのアクセスを避けるようにしてください。（例えば、ファイルを直接書き換えるなどの動作は不具合を引き起こす可能性が高くなるほか、VOICEVOXが事前テストで動作確認できてないような望まない動作を引き起こす可能性があります。）

基本的にVOICEVOXで音声を合成するために必要なAPIはすでに用意されていますが、もしAPIで実現できない機能/操作がある場合は、VOIEVOX の Issue ページにてAPIの実装提案を行う事をお勧めします。

### APIのアクセス先について

従来は、エンジン毎に通信ポート番号が固定されていました。たとえば、VOICEVOXエンジンであれば 50021 といった感じです。しかし、現在のエンジンはポート番号の競合に伴う起動エラーを避けるため、起動するタイミングで通信ポートの番号を動的に決めるようになっています。

以上のことから、アクセスするべきエンジンポートが 50021 ではない可能性があります。サードパーティツールは、やみくもにエンドポイントを仮定してアクセスするのではなく、最初に「情報ファイル」を参照してAPIのエンドポイントを特定してください。

### ランタイム情報ファイル（以下情報ファイル）について

そのため、サードパーティがエンジンの通信ポートを特定するために「情報ファイル」というものが生成されるようになっています。サードパーティでアプリケーションを作る製作者は、まずはこのファイルを参照してアクセス先を決定してください。

また、VOICEVOX内でエンジンが再起動した場合に、通信ポート番号が変わる可能性があります。サードパーティ側でAPI使用中に突如通信失敗が発生した場合は、このファイルが更新されているか確認するようにしてください。

（なお、古いVOICEVOXではこのファイル生成機能が実装されていません。また、動的にポート番号を決定しないバージョンもあります。下位互換性を保つためには、このファイルがない場合も想定してください）

## 情報ファイルについて

### ファイルの場所

ファイルは下記の場所にあります。

|OS              |ファイルパス                                 |
|----------------|--------------------------------------------|
|Windows         |%LOCALAPPDATA%\\voicevox\\runtime-info.json |
|MacOS           |~\\.voicevox\\runtime-info.json             |

### ファイルの中身と意味

ファイル自体はJSON形式になっています。構造としては下記のような形になります。

```JSON
{
  "appVersion": "xxx.yyy.zzz",
  "formatVersion": 1,
  "engineInfos": [
    {
      "name": "engine1",
      "url": "http://127.0.0.1:50021",
      "uuid": "00000000-0000-0000-0000-000000000001",
    },
    {
      "name": "engine2",
      "url": "http://127.0.0.1:50121",
      "uuid": "00000000-0000-0000-0000-000000000002",
    },
  ]
}
```

|キー            |値の意味                                     |型       |
|----------------|--------------------------------------------|---------|
|appVersion      |VOICEVOXのバージョン                         |string   |
|engineInfos     |エンジンデータ（エンジンの数だけあります）      |配列      |
|name            |エンジン通称                                 |string   |
|url             |APIエンドポイント                            |string   |
|uuid            |エンジン識別用のユニークなID                  |string   |
|formatVersion   |ファイル構造バージョン                        |number   |

### 生成されるタイミング

* エンジンが起動（もしくは再起動）するタイミングでファイルが生成、更新されます。
* 何らかの理由でファイルの書き込み権が取得できなかった場合には更新されません。（更新のタイミングで他ツールがファイルを開いていた場合など）
