NOTE:
https://github.com/electron/rebuild/commit/2efb86db3e10e38f08f7be07c119f56b876c907d の backport。
pnpmで@electron/rebuildを使うときにたまにENOENTが発生する問題の修正。

diff --git a/lib/module-walker.js b/lib/module-walker.js
index b36e35c968c85b625f2080466f6518b1d355e4ef..c696497b36bfee5a917a9e88fb4d05d45a0f9cf0 100644
--- a/lib/module-walker.js
+++ b/lib/module-walker.js
@@ -89,9 +89,24 @@ class ModuleWalker {
             // Ignore the magical .bin directory
             if (modulePath === '.bin')
                 continue;
+
+            const subPath = path_1.default.resolve(nodeModulesPath, modulePath);
+
             // Ensure that we don't mark modules as needing to be rebuilt more than once
             // by ignoring / resolving symlinks
-            const realPath = await fs_extra_1.default.realpath(path_1.default.resolve(nodeModulesPath, modulePath));
+
+            let realPath;
+            try {
+                realPath = await fs_extra_1.default.realpath(subPath);
+            } catch (err) {
+                if (err.code === 'ENOENT') {
+                    const stats = await fs_extra_1.default.lstat(subPath);
+                    if (stats.isSymbolicLink()) {
+                        // If the symlink is broken, just continue on
+                        continue;
+                    }
+                }
+                // Re-throw if not handled above
+                throw err;
+            }
             if (this.realModulePaths.has(realPath)) {
                 continue;
             }
